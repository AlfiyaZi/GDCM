INCLUDE_REGULAR_EXPRESSION("^.*$")

SET(JPEGLS_SRCS
  global.c 
  jpegmark.c 
  initialize.c 
  decoder.c 
  lossless_d.c 
  lossy_d.c 
  bitio.c 
  melcode.c)

# Do the -fno-common magic
IF(APPLE)
  FOREACH(f ${JPEGLS_SRCS})
    SET_SOURCE_FILES_PROPERTIES(
      "${CMAKE_CURRENT_SOURCE_DIR}/${f}"
      PROPERTIES COMPILE_FLAGS -fno-common)
  ENDFOREACH(f)
ENDIF(APPLE)


ADD_LIBRARY(${JPEGLS_LIBRARY_NAME} ${JPEGLS_SRCS})
SET_TARGET_PROPERTIES(${JPEGLS_LIBRARY_NAME} PROPERTIES ${GDCM_LIBRARY_PROPERTIES})
#ADD_EXECUTABLE(locod ${JPEGLS_SRCS})

# TODO must do the INSTALL_ blah thing
IF(NOT JPEGLS_INSTALL_NO_LIBRARIES)
INSTALL(TARGETS ${JPEGLS_LIBRARY_NAME}
    RUNTIME DESTINATION ${JPEGLS_INSTALL_BIN_DIR} COMPONENT Runtime
    LIBRARY DESTINATION ${JPEGLS_INSTALL_LIB_DIR} COMPONENT Runtime
    ARCHIVE DESTINATION ${JPEGLS_INSTALL_LIB_DIR} COMPONENT Development
	)
ENDIF(NOT JPEGLS_INSTALL_NO_LIBRARIES)
